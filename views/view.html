<%- include('partials/head.html') %>
<%- include('partials/header.html') %>
<div class="field">
  <label class="label">Search all names:</label>
  <div class="control">
    <input class="input" id="any" type="text" placeholder="Type name, year, other info">
  </div>
</div>

<div style="overflow-x:auto;">
<table id="table" class="table is-striped">

</table>
</div>

  <script>
    var people = <%- JSON.stringify(people) %>
    console.log(people);
    function debounce(func, wait, immediate) {
      var timeout;
      return function() {
        var context = this, args = arguments;
        var later = function() {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    };
    $(document).ready(function() {
      renderTable(people);
      var options = {
      keys: ['firstName', 'lastName', 'middleName', 'gradYear', 'admitYear', 
            'postPennCareer', 'pennCareer', 'tags']
      }
      var fuse = new Fuse(people, options)

      $('#any').on('keyup', debounce(function() {
        if ($('#any').val().length > 3) {
          var res = fuse.search($('#any').val());
          console.log(res.slice(0, 50));
          renderTable(res.slice(0, 50));
        } else if ($('#any').val().length == 0) {
          renderTable(people);
        }
      }, 500));
    })

    function renderTable(data) {
      var people = data;
      $('table').empty();
      
      $('#table').append(`
                         <thead>
                         <tr>
                         <th>View</th>
                         <th>Tag</th>
                         <th>Admit Year</th>
                         <th>First Name</th>
                         <th>Middle Name</th>
                         <th>Last Name</th>
                         <th>Grad Year</th>
                         <th>Penn Career</th>
                         <th>Post Penn Career</th>
                         </tr>
                         </thead>
                         `);
      for (p in people) {
        $('#table').append(`<tr>
                          <td><a href="/protected/alumni/${people[p]._id}">View</a></td>
                          <td>${people[p].tags ? people[p].tags.map(i => { 
                             return `<span class="tag is-primary">${i.tagName}</span>`
                           }).join('') : 'None'}
                          </td>
                          <td>${people[p].admitYear}</td>
                          <td>${ people[p].firstName }</td>
                          <td>${ people[p].middleName }</td>
                          <td>${ people[p].lastName }</td>
                          <td>${ people[p].gradYear }</td>
                          <td>${ people[p].pennCareer }</td>
                          <td>${ people[p].postPennCareer }</td>
                          </tr>
        `);
      }
    }
  </script>
<%- include('partials/footer.html') %>
